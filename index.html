<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <main>
      <button id="connect-button">Connect</button>
    </main>
    <script>
      const connectButton = document.getElementById("connect-button");
      console.log(connectButton);
      connectButton.addEventListener("click", connectMetaMask);

      async function connectMetaMask() {
        if (window.ethereum) {
          try {
            // Request MetaMask account access
            const accounts = await window.ethereum.request({
              method: "eth_requestAccounts",
            });
            const account = accounts[0];

            // Initialize Web3 with MetaMask provider
            const web3 = new Web3(window.ethereum);

            // Fetch account balance
            const balanceWei = await web3.eth.getBalance(account);
            const balanceEth = web3.utils.fromWei(balanceWei, "ether");

            // Display account and balance information
            alert(
              "Connected account: " +
                account +
                "\nBalance: " +
                balanceEth +
                " ETH"
            );

            // Send account and balance to Unity (if Unity instance is available)
            if (unityInstanceRef) {
              unityInstanceRef.SendMessage(
                "JavaScriptHook",
                "OnMetaMaskConnected",
                JSON.stringify({
                  account: account,
                  balance: balanceEth,
                })
              );
            }
          } catch (error) {
            // Handle errors
            console.error("Error connecting MetaMask:", error);
            if (error.code === 4001) {
              alert("User denied account access");
            } else {
              alert("Error connecting MetaMask. Please try again.");
            }
          }
        } else {
          // MetaMask is not detected
          if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
            // Redirect iOS users to MetaMask on the App Store
            window.location.href =
              "https://apps.apple.com/us/app/metamask/id1438144202";
          } else if (/Android/i.test(navigator.userAgent)) {
            // Redirect Android users to MetaMask on Google Play Store
            window.location.href =
              "https://play.google.com/store/apps/details?id=io.metamask";
          } else {
            // Redirect other users to MetaMask website for download
            window.location.href = "https://metamask.io/download.html";
          }
        }
      }
    </script>
  </body>
</html>
